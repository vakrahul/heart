<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Assessment - HeartShield</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * { 
            font-family: 'Inter', sans-serif; 
        }
        
        body {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 25%, #f87171 50%, #fca5a5 75%, #fecaca 100%);
            background-attachment: fixed;
            min-height: 100vh;
            margin: 0;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(220, 38, 38, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(248, 113, 113, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .floating-shapes {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: -1;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            animation: float 8s ease-in-out infinite;
            opacity: 0.1;
        }

        .shape:nth-child(1) {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, #ffffff, #fecaca);
            top: 15%;
            left: 85%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 150px;
            height: 150px;
            background: linear-gradient(45deg, #dc2626, #ef4444);
            top: 60%;
            left: 10%;
            animation-delay: 3s;
        }

        .shape:nth-child(3) {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #ffffff, #f87171);
            top: 25%;
            right: 25%;
            animation-delay: 6s;
        }

        .shape:nth-child(4) {
            width: 120px;
            height: 120px;
            background: linear-gradient(45deg, #fca5a5, #ffffff);
            bottom: 20%;
            left: 70%;
            animation-delay: 2s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-40px) rotate(120deg); }
            66% { transform: translateY(20px) rotate(240deg); }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(220, 38, 38, 0.2);
            border-radius: 20px;
        }

        .navbar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 40px; 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(220, 38, 38, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-left { display: flex; align-items: center; gap: 50px; }
        .navbar-left h2 { color: #dc2626; display: flex; align-items: center; gap: 8px; margin: 0; font-weight: 700; }
        .navbar-links { display: flex; gap: 30px; }
        .navbar-links a { 
            text-decoration: none; 
            color: #374151; 
            font-weight: 500; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            transition: all 0.3s ease;
            padding: 8px 16px;
            border-radius: 10px;
        }
        .navbar-links a:hover {
            color: #dc2626;
            background: rgba(220, 38, 38, 0.1);
            transform: translateY(-2px);
        }

        .navbar-right { display: flex; align-items: center; gap: 20px; }
        .navbar-right button, .navbar-right a {
            background: none;
            border: none;
            color: #374151;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .navbar-right button:hover, .navbar-right a:hover {
            color: #dc2626;
            background: rgba(220, 38, 38, 0.1);
        }

        .container { 
            max-width: 900px; 
            margin: 40px auto; 
            padding: 40px; 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px; 
            box-shadow: 0 20px 60px rgba(220, 38, 38, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .container h2 {
            text-align: center;
            color: #dc2626;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
            text-shadow: 0 2px 4px rgba(220, 38, 38, 0.1);
        }

        .assessment-tabs { 
            display: flex; 
            border-bottom: 2px solid rgba(220, 38, 38, 0.1); 
            margin-bottom: 30px; 
            overflow: hidden;
            border-radius: 12px 12px 0 0;
        }

        .tab-button { 
            flex: 1; 
            padding: 20px; 
            border: none; 
            background: rgba(220, 38, 38, 0.05); 
            cursor: pointer; 
            font-size: 1.1rem; 
            font-weight: 600; 
            border-bottom: 4px solid transparent; 
            transition: all 0.3s ease; 
            color: #6b7280;
        }

        .tab-button.active { 
            background: rgba(255, 255, 255, 0.9); 
            border-bottom: 4px solid #dc2626; 
            color: #dc2626; 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
        }

        .tab-button:hover:not(.active) { 
            background: rgba(220, 38, 38, 0.1); 
            transform: translateY(-2px); 
            color: #dc2626;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .upload-box { 
            border: 3px dashed #dc2626; 
            padding: 40px; 
            text-align: center; 
            border-radius: 16px; 
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(254, 202, 202, 0.3) 100%);
            transition: all 0.3s ease; 
            position: relative;
            overflow: hidden;
        }

        .upload-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .upload-box:hover { 
            border-color: #ef4444; 
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(254, 202, 202, 0.5) 100%);
            transform: translateY(-4px); 
            box-shadow: 0 12px 30px rgba(220, 38, 38, 0.25); 
        }

        .upload-box h4 {
            color: #dc2626;
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .btn {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
            background: linear-gradient(135deg, #ef4444, #f87171);
        }

        .form-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 24px; 
            margin-top: 30px;
        }

        .form-group { 
            transition: all 0.3s ease;
            position: relative;
        }

        .form-group:hover { 
            transform: translateY(-2px); 
        }

        .form-group label { 
            margin-bottom: 8px; 
            font-weight: 600; 
            color: #374151;
            display: block;
            font-size: 0.95rem;
        }

        .form-grid input, .form-grid select { 
            width: 100%; 
            padding: 14px 16px; 
            border: 2px solid #e5e7eb; 
            border-radius: 12px; 
            font-size: 1rem; 
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .form-grid input:focus, .form-grid select:focus { 
            border-color: #dc2626; 
            box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.1); 
            outline: none; 
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
        }

        .actions { 
            text-align: center; 
            margin-top: 40px; 
        }

        .btn-danger { 
            background: linear-gradient(135deg, #dc2626, #ef4444); 
            color: #fff; 
            padding: 16px 32px; 
            border: none; 
            border-radius: 16px; 
            font-weight: 700; 
            cursor: pointer; 
            position: relative; 
            overflow: hidden; 
            transition: all 0.3s ease; 
            font-size: 1.1rem;
            min-width: 200px;
        }

        .btn-danger:hover:not(.loading) { 
            transform: translateY(-3px); 
            box-shadow: 0 12px 30px rgba(220, 38, 38, 0.4); 
            background: linear-gradient(135deg, #ef4444, #f87171);
        }

        .btn-danger.loading { 
            color: transparent; 
            cursor: not-allowed; 
        }

        .btn-danger.loading::after { 
            content: ''; 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            width: 24px; 
            height: 24px; 
            margin: -12px 0 0 -12px; 
            border: 3px solid rgba(255,255,255,0.3); 
            border-radius: 50%; 
            border-top-color: white; 
            animation: spin 1s linear infinite; 
        }

        .spinner { 
            border: 4px solid rgba(220, 38, 38, 0.1); 
            width: 32px; 
            height: 32px; 
            border-radius: 50%; 
            border-left-color: #dc2626; 
            animation: spin 1s ease infinite; 
            display: none; 
            margin: 20px auto; 
        }
        
        /* ENHANCED LOADING OVERLAY */
        #loading-splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.97) 0%, rgba(239, 68, 68, 0.97) 50%, rgba(248, 113, 113, 0.97) 100%);
            backdrop-filter: blur(20px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            gap: 30px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        
        #loading-splash.show {
            opacity: 1;
        }
        
        .loading-content {
            text-align: center;
            color: white;
            animation: fadeInScale 0.8s ease-out;
        }
        
        .heart-pulse {
            font-size: 6rem;
            color: white;
            margin-bottom: 30px;
            animation: heartPulseLoading 1.5s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(255,255,255,0.6));
        }
        
        .loading-text {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            animation: textGlow 2s ease-in-out infinite alternate;
        }
        
        .loading-subtext {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 40px;
            font-weight: 300;
        }
        
        .progress-container {
            width: 350px;
            margin: 30px auto;
        }
        
        .progress-bar-bg {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #fff, rgba(255,255,255,0.8));
            width: 0%;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(255,255,255,0.6);
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            font-size: 1rem;
            margin-top: 15px;
            opacity: 0.9;
            font-weight: 500;
        }
        
        .analysis-steps {
            margin-top: 40px;
            text-align: left;
            max-width: 450px;
        }
        
        .step-item {
            display: flex;
            align-items: center;
            margin: 20px 0;
            font-size: 1.1rem;
            opacity: 0.4;
            transition: all 0.5s ease;
            font-weight: 500;
        }
        
        .step-item.active {
            opacity: 1;
            transform: translateX(10px);
        }
        
        .step-item.completed {
            opacity: 0.8;
            transform: translateX(0);
        }
        
        .step-item i {
            margin-right: 20px;
            width: 24px;
            font-size: 1.3rem;
        }
        
        .step-check {
            color: #4ade80;
        }
        
        .step-processing {
            animation: spin 1s linear infinite;
            color: #fbbf24;
        }
        
        .loading-dots {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 30px;
        }
        
        .loading-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: rgba(255,255,255,0.8);
            animation: dotBounce 1.4s ease-in-out infinite;
        }
        
        .loading-dot:nth-child(1) { animation-delay: 0s; }
        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }
        
        /* Animations */
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        @keyframes heartPulseLoading {
            0%, 100% { 
                transform: scale(1);
                filter: drop-shadow(0 0 30px rgba(255,255,255,0.6));
            }
            50% { 
                transform: scale(1.15);
                filter: drop-shadow(0 0 40px rgba(255,255,255,0.9));
            }
        }
        
        @keyframes textGlow {
            0% { text-shadow: 0 0 30px rgba(255,255,255,0.6); }
            100% { text-shadow: 0 0 40px rgba(255,255,255,0.9); }
        }
        
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes dotBounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-15px); }
            60% { transform: translateY(-7px); }
        }

        body.dark-mode {
            background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 25%, #b91c1c 50%, #dc2626 75%, #ef4444 100%);
        }

        body.dark-mode::before {
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(127, 29, 29, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(153, 27, 27, 0.3) 0%, transparent 50%);
        }

        body.dark-mode .navbar {
            background: rgba(55, 65, 81, 0.95);
        }

        body.dark-mode .container {
            background: rgba(55, 65, 81, 0.95);
            color: #e5e7eb;
        }

        body.dark-mode .container h2 {
            color: #f87171;
        }

        body.dark-mode .form-group label {
            color: #e5e7eb;
        }

        body.dark-mode .form-grid input, 
        body.dark-mode .form-grid select {
            background: rgba(75, 85, 99, 0.8);
            border-color: #4b5563;
            color: #e5e7eb;
        }

        body.dark-mode .form-grid input:focus, 
        body.dark-mode .form-grid select:focus {
            border-color: #f87171;
            box-shadow: 0 0 0 4px rgba(248, 113, 113, 0.2);
            background: rgba(75, 85, 99, 0.9);
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container { 
                margin: 20px; 
                padding: 20px; 
            }
            .navbar { 
                padding: 10px 20px; 
                flex-direction: column; 
                gap: 20px; 
                height: auto;
            }
            .navbar-left { 
                flex-direction: column; 
                gap: 20px; 
                text-align: center; 
            }
            .navbar-links { 
                flex-direction: column; 
                gap: 15px; 
            }
            .form-grid { 
                grid-template-columns: 1fr; 
                gap: 16px; 
            }
            .loading-text { font-size: 1.6rem; }
            .heart-pulse { font-size: 4.5rem; }
            .progress-container { width: 280px; }
        }
    </style>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="navbar">
        <div class="navbar-left">
            <h2><i class="fa-solid fa-heart"></i> HeartShield</h2>
            <div class="navbar-links">
                <a href="{{ url_for('dashboard') }}"><i class="fa-solid fa-chart-line"></i> Dashboard</a>
                <a href="{{ url_for('assessment') }}"><i class="fa-solid fa-file-medical"></i> New Assessment</a>
                <a href="{{ url_for('profile') }}"><i class="fa-solid fa-user"></i> Profile</a>
            </div>
        </div>
        <div class="navbar-right">
            <button onclick="toggleTheme()"><i class="fa-solid fa-circle-half-stroke"></i></button>
            <span>Welcome, <b>{{ current_user.fullName.split(' ')[0] }}</b></span>
            <a href="{{ url_for('logout') }}"><i class="fa-solid fa-right-from-bracket"></i></a>
        </div>
    </div>

    <div class="container glass-card">
        <h2>Heart Disease Risk Assessment</h2>
        <div class="assessment-tabs">
            <button class="tab-button active" onclick="switchTab('ocr')">
                <i class="fa-solid fa-upload"></i> Upload with OCR
            </button>
            <button class="tab-button" onclick="switchTab('manual')">
                <i class="fa-solid fa-keyboard"></i> Enter Manually
            </button>
        </div>

        <div id="ocr" class="tab-content active">
            <div class="upload-box">
                <i class="fa-solid fa-cloud-upload-alt" style="font-size: 3rem; color: #dc2626; margin-bottom: 20px;"></i>
                <h4>For faster results, upload a medical report image.</h4>
                <p style="color: #6b7280; margin-bottom: 20px;">Supported formats: PNG, JPEG</p>
                <input type="file" id="ocrFileUpload" accept="image/png, image/jpeg" style="display: none;">
                <label for="ocrFileUpload" class="btn btn-primary">
                    <i class="fa-solid fa-plus"></i>
                    Upload & Auto-fill Document
                </label>
                <div id="ocrStatus" style="margin-top: 20px; font-style: italic; color: #6b7280;"></div>
                <div class="spinner" id="spinner"></div>
            </div>
            <p style="text-align:center; color: #6b7280; margin: 30px 0; font-weight: 500;">Review the auto-filled values below, correct them if needed, and submit.</p>
            
            <form id="ocr-form" method="POST" action="{{ url_for('analyze') }}">
                <div class="form-grid">
                    <div class="form-group"><label for="ocr-male"><i class="fa-solid fa-venus-mars"></i> Sex</label><select id="ocr-male" name="male"><option value="">Select...</option><option value="1">Male</option><option value="0">Female</option></select></div>
                    <div class="form-group"><label for="ocr-age"><i class="fa-solid fa-birthday-cake"></i> Age</label><input type="number" id="ocr-age" name="age"></div>
                    <div class="form-group"><label for="ocr-education"><i class="fa-solid fa-graduation-cap"></i> Education Level</label><input type="number" id="ocr-education" name="education"></div>
                    <div class="form-group"><label for="ocr-currentSmoker"><i class="fa-solid fa-smoking"></i> Current Smoker</label><select id="ocr-currentSmoker" name="currentSmoker"><option value="">Select...</option><option value="1">Yes</option><option value="0">No</option></select></div>
                    <div class="form-group"><label for="ocr-cigsPerDay"><i class="fa-solid fa-cigarette"></i> Cigarettes Per Day</label><input type="number" id="ocr-cigsPerDay" name="cigsPerDay"></div>
                    <div class="form-group"><label for="ocr-BPMeds"><i class="fa-solid fa-pills"></i> On BP Medication</label><select id="ocr-BPMeds" name="BPMeds"><option value="">Select...</option><option value="1">Yes</option><option value="0">No</option></select></div>
                    <div class="form-group"><label for="ocr-prevalentStroke"><i class="fa-solid fa-brain"></i> History of Stroke</label><select id="ocr-prevalentStroke" name="prevalentStroke"><option value="">Select...</option><option value="1">Yes</option><option value="0">No</option></select></div>
                    <div class="form-group"><label for="ocr-prevalentHyp"><i class="fa-solid fa-heartbeat"></i> History of Hypertension</label><select id="ocr-prevalentHyp" name="prevalentHyp"><option value="">Select...</option><option value="1">Yes</option><option value="0">No</option></select></div>
                    <div class="form-group"><label for="ocr-diabetes"><i class="fa-solid fa-tint"></i> History of Diabetes</label><select id="ocr-diabetes" name="diabetes"><option value="">Select...</option><option value="1">Yes</option><option value="0">No</option></select></div>
                    <div class="form-group"><label for="ocr-totChol"><i class="fa-solid fa-vial"></i> Total Cholesterol</label><input type="number" id="ocr-totChol" name="totChol"></div>
                    <div class="form-group"><label for="ocr-sysBP"><i class="fa-solid fa-thermometer-half"></i> Systolic BP</label><input type="number" id="ocr-sysBP" name="sysBP"></div>
                    <div class="form-group"><label for="ocr-diaBP"><i class="fa-solid fa-thermometer-quarter"></i> Diastolic BP</label><input type="number" id="ocr-diaBP" name="diaBP"></div>
                    <div class="form-group"><label for="ocr-BMI"><i class="fa-solid fa-weight-scale"></i> BMI</label><input type="number" step="0.01" id="ocr-BMI" name="BMI"></div>
                    <div class="form-group"><label for="ocr-heartRate"><i class="fa-solid fa-heart"></i> Heart Rate</label><input type="number" id="ocr-heartRate" name="heartRate"></div>
                    <div class="form-group"><label for="ocr-glucose"><i class="fa-solid fa-cookie-bite"></i> Glucose Level</label><input type="number" id="ocr-glucose" name="glucose"></div>
                </div>
                <div class="actions">
                    <button type="submit" class="btn-danger">
                        <i class="fa-solid fa-chart-line"></i>
                        Analyze Filled Values
                    </button>
                </div>
            </form>
        </div>

        <div id="manual" class="tab-content">
            <p style="text-align:center; color: #6b7280; font-weight: 500; margin-bottom: 30px;">Please enter all values manually below.</p>
            <form id="manual-form" method="POST" action="{{ url_for('analyze') }}">
                <div class="form-grid">
                    <div class="form-group"><label for="manual-male"><i class="fa-solid fa-venus-mars"></i> Sex</label><select id="manual-male" name="male" required><option value="">Select...</option><option value="1">Male</option><option value="0">Female</option></select></div>
                    <div class="form-group"><label for="manual-age"><i class="fa-solid fa-birthday-cake"></i> Age</label><input type="number" id="manual-age" name="age" required></div>
                    <div class="form-group"><label for="manual-education"><i class="fa-solid fa-graduation-cap"></i> Education Level</label><input type="number" id="manual-education" name="education"></div>
                    <div class="form-group"><label for="manual-currentSmoker"><i class="fa-solid fa-smoking"></i> Current Smoker</label><select id="manual-currentSmoker" name="currentSmoker" required><option value="">Select...</option><option value="1">Yes</option><option value="0">No</option></select></div>
                    <div class="form-group"><label for="manual-cigsPerDay"><i class="fa-solid fa-cigarette"></i> Cigarettes Per Day</label><input type="number" id="manual-cigsPerDay" name="cigsPerDay" required></div>
                    <div class="form-group"><label for="manual-BPMeds"><i class="fa-solid fa-pills"></i> On BP Medication</label><select id="manual-BPMeds" name="BPMeds" required><option value="">Select...</option><option value="1">Yes</option><option value="0">No</option></select></div>
                    <div class="form-group"><label for="manual-prevalentStroke"><i class="fa-solid fa-brain"></i> History of Stroke</label><select id="manual-prevalentStroke" name="prevalentStroke" required><option value="">Select...</option><option value="1">Yes</option><option value="0">No</option></select></div>
                    <div class="form-group"><label for="manual-prevalentHyp"><i class="fa-solid fa-heartbeat"></i> History of Hypertension</label><select id="manual-prevalentHyp" name="prevalentHyp" required><option value="">Select...</option><option value="1">Yes</option><option value="0">No</option></select></div>
                    <div class="form-group"><label for="manual-diabetes"><i class="fa-solid fa-tint"></i> History of Diabetes</label><select id="manual-diabetes" name="diabetes" required><option value="">Select...</option><option value="1">Yes</option><option value="0">No</option></select></div>
                    <div class="form-group"><label for="manual-totChol"><i class="fa-solid fa-vial"></i> Total Cholesterol</label><input type="number" id="manual-totChol" name="totChol" required></div>
                    <div class="form-group"><label for="manual-sysBP"><i class="fa-solid fa-thermometer-half"></i> Systolic BP</label><input type="number" id="manual-sysBP" name="sysBP" required></div>
                    <div class="form-group"><label for="manual-diaBP"><i class="fa-solid fa-thermometer-quarter"></i> Diastolic BP</label><input type="number" id="manual-diaBP" name="diaBP" required></div>
                    <div class="form-group"><label for="manual-BMI"><i class="fa-solid fa-weight-scale"></i> Body Mass Index</label><input type="number" step="0.01" id="manual-BMI" name="BMI" required></div>
                    <div class="form-group"><label for="manual-heartRate"><i class="fa-solid fa-heart"></i> Heart Rate</label><input type="number" id="manual-heartRate" name="heartRate" required></div>
                    <div class="form-group"><label for="manual-glucose"><i class="fa-solid fa-cookie-bite"></i> Glucose Level</label><input type="number" id="manual-glucose" name="glucose" required></div>
                </div>
                <div class="actions">
                    <button type="submit" class="btn-danger">
                        <i class="fa-solid fa-chart-line"></i>
                        Analyze Risk
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ENHANCED LOADING OVERLAY -->
    <div id="loading-splash">
        <div class="loading-content">
            <div class="heart-pulse">
                <i class="fa-solid fa-heart"></i>
            </div>
            <div class="loading-text">Analyzing Your Health Data</div>
            <div class="loading-subtext">Please wait while we process your information</div>
            
            <div class="progress-container">
                <div class="progress-bar-bg">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div class="progress-text" id="progress-text">Initializing...</div>
            </div>
            
            <div class="analysis-steps">
                <div class="step-item" id="step-1">
                    <i class="fa-solid fa-spinner step-processing" id="icon-1"></i>
                    <span>Processing health parameters...</span>
                </div>
                <div class="step-item" id="step-2">
                    <i class="fa-solid fa-spinner" id="icon-2"></i>
                    <span>Running risk assessment algorithms...</span>
                </div>
                <div class="step-item" id="step-3">
                    <i class="fa-solid fa-spinner" id="icon-3"></i>
                    <span>Generating personalized report...</span>
                </div>
                <div class="step-item" id="step-4">
                    <i class="fa-solid fa-spinner" id="icon-4"></i>
                    <span>Finalizing results...</span>
                </div>
            </div>

            <div class="loading-dots">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='global.js') }}"></script>
    <script>
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab-button[onclick="switchTab('${tabName}')"]`).classList.add('active');
        }

        document.getElementById('ocrFileUpload').addEventListener('change', async function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const ocrStatus = document.getElementById('ocrStatus');
            const spinner = document.getElementById('spinner');
            const formData = new FormData();
            formData.append('file', file);
            
            ocrStatus.innerHTML = '<i class="fa-solid fa-cog fa-spin"></i> Processing... This may take a moment.';
            ocrStatus.style.color = '#dc2626';
            spinner.style.display = 'block';
            
            try {
                const response = await fetch("{{ url_for('ocr_process') }}", { 
                    method: 'POST', 
                    body: formData 
                });
                
                if (!response.ok) throw new Error('Server error');
                
                const data = await response.json();
                let valuesFound = 0;
                
                for (const key in data) {
                    const inputElement = document.getElementById(`ocr-${key}`);
                    if (inputElement) {
                        inputElement.value = data[key];
                        inputElement.style.background = 'rgba(34, 197, 94, 0.1)';
                        inputElement.style.borderColor = '#22c55e';
                        valuesFound++;
                    }
                }
                
                if (valuesFound > 0) {
                    ocrStatus.innerHTML = `<i class="fa-solid fa-check-circle" style="color: #22c55e;"></i> Auto-fill complete! Found ${valuesFound} values. Please review and submit.`;
                    ocrStatus.style.color = '#22c55e';
                } else {
                    ocrStatus.innerHTML = '<i class="fa-solid fa-exclamation-triangle" style="color: #f59e0b;"></i> OCR ran, but no matching values were found.';
                    ocrStatus.style.color = '#f59e0b';
                }
            } catch (error) {
                ocrStatus.innerHTML = '<i class="fa-solid fa-times-circle" style="color: #ef4444;"></i> Failed to process the document.';
                ocrStatus.style.color = '#ef4444';
            } finally {
                spinner.style.display = 'none';
            }
        });

        // REALISTIC LOADING ANIMATION
        function showLoadingAnimation() {
            const loadingSplash = document.getElementById('loading-splash');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            
            loadingSplash.style.display = 'flex';
            setTimeout(() => loadingSplash.classList.add('show'), 10);

            let currentProgress = 0;
            let currentStep = 0;
            
            const steps = [
                { element: 'step-1', text: 'Processing health parameters...', duration: 1000 },
                { element: 'step-2', text: 'Running risk assessment algorithms...', duration: 1200 },
                { element: 'step-3', text: 'Generating personalized report...', duration: 1000 },
                { element: 'step-4', text: 'Finalizing results...', duration: 800 }
            ];

            function updateProgress(percent, text) {
                progressBar.style.width = percent + '%';
                progressText.textContent = text;
            }

            function activateStep(stepIndex) {
                if (stepIndex > 0) {
                    const prevStep = document.getElementById(`step-${stepIndex}`);
                    const prevIcon = document.getElementById(`icon-${stepIndex}`);
                    prevStep.classList.remove('active');
                    prevStep.classList.add('completed');
                    prevIcon.className = 'fa-solid fa-check step-check';
                }

                if (stepIndex < steps.length) {
                    const currentStep = document.getElementById(`step-${stepIndex + 1}`);
                    const currentIcon = document.getElementById(`icon-${stepIndex + 1}`);
                    currentStep.classList.add('active');
                    currentIcon.className = 'fa-solid fa-spinner step-processing';
                }
            }

            let totalTime = 0;
            steps.forEach((step, index) => {
                setTimeout(() => {
                    activateStep(index);
                    updateProgress((index + 1) * 25, step.text);
                }, totalTime);
                totalTime += step.duration;
            });

            setTimeout(() => {
                const finalStep = document.getElementById('step-4');
                const finalIcon = document.getElementById('icon-4');
                finalStep.classList.remove('active');
                finalStep.classList.add('completed');
                finalIcon.className = 'fa-solid fa-check step-check';
                updateProgress(100, 'Analysis complete! Redirecting...');
            }, totalTime);

            const minimumTime = Math.max(totalTime + 500, 3000);
            
            return new Promise(resolve => {
                setTimeout(resolve, minimumTime);
            });
        }

        // Enhanced form submissions
        document.getElementById('ocr-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const submitBtn = this.querySelector('.btn-danger');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
            await showLoadingAnimation();
            this.submit();
        });

        document.getElementById('manual-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const submitBtn = this.querySelector('.btn-danger');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
            await showLoadingAnimation();
            this.submit();
        });

        // Enhanced form interactions
        document.querySelectorAll('.form-grid input, .form-grid select').forEach(element => {
            element.addEventListener('focus', function() {
                this.parentElement.style.transform = 'translateY(-2px)';
                this.parentElement.style.boxShadow = '0 6px 20px rgba(220, 38, 38, 0.15)';
            });

            element.addEventListener('blur', function() {
                this.parentElement.style.transform = 'translateY(0)';
                this.parentElement.style.boxShadow = 'none';
            });
        });

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            
            document.body.style.transition = 'all 0.3s ease';
            setTimeout(() => {
                document.body.style.transition = '';
            }, 300);
        }

        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
    </script>
       <div class="chat-window" id="chat-window">
        <div class="chat-header">HeartShield Assistant</div>
        <div class="chat-messages" id="chat-messages">
            <div class="message bot">Hello! How can I help?</div>
        </div>
        <form class="chat-input-form" id="chat-form">
            <input type="text" id="chat-input" placeholder="Type your message...">
            <button type="submit"><i class="fa-solid fa-paper-plane"></i></button>
        </form>
    </div>
</body>
</html>